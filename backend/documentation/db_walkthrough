# DB Walkthrough - Projeto ISCTE

## 1. Preparar a base de dados MongoDB

1. **Verifica o ficheiro `docker-compose.yml`**
   - O servi√ßo `mongo` deve ter as seguintes vari√°veis e portas:
     ```yaml
   mongo:
    image: mongo:latest
    container_name: mongo_db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=senhaadmin
      - MONGO_INITDB_DATABASE=auth_db
      - MONGO_INITDB_USERNAME=app_user
      - MONGO_INITDB_PASSWORD=app_password
    ports:
      - "27017:27017"  # Expose MongoDB on port 27017, adicionado a 03/6 TM
    networks:
      - dsa-network
    volumes:
      - mongodb_data:/data/db
      - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro

     ```
   - Estas credenciais ser√£o usadas para aceder √† base de dados.

2. **Inicia os containers Docker**
   ```sh
   docker-compose up -d
   ```
   - Isto vai iniciar o MongoDB e o backend.

3. **Configura o ficheiro `.env`**
   - No diret√≥rio `backend`, cria ou edita o ficheiro `.env` com a seguinte linha:
     ```
     MONGODB_URI=mongodb://app_user:app_password@localhost:27017/auth_db
     ```
   - Garante que usas exatamente as mesmas credenciais que est√£o no `docker-compose.yml`.
   - Salva o ficheiro antes de correres o seed ou o backend.

## 2. Popular a base de dados com dados de teste

1. **Garante que o MongoDB est√° a correr**
   ```sh
   docker-compose up -d
   docker ps
   ```
   - Deves ver o container `mongo_db` ativo.

2. **Corre o script de seed**
   - No terminal, navega at√© √† pasta `backend/data`:
     ```sh
     cd backend/data
     node seed.js
     ```
   - Se tudo correr bem, deves ver:
     ```
     ‚ú® Base de dados MongoDB populada com sucesso!
     ```

3. **Se aparecer erro `ECONNREFUSED`**
   - Verifica se a porta 27017 est√° exposta no `docker-compose.yml`.
   - Confirma que o `.env` tem as credenciais certas.
   - Reinicia os containers:
     ```sh
     docker-compose down
     docker-compose up -d
     ```

---

## 3. Visualizar a base de dados no MongoDB Compass

1. **Instala o [MongoDB Compass](https://www.mongodb.com/try/download/compass)**

2. **Abre o Compass e liga-te com a seguinte string:**
    Adiciona uma nova connection com a string:
    
   ```
   mongodb://app_user:app_password@localhost:27017/auth_db
   ```

3. **V√™ a base de dados e cole√ß√µes**
   - Vais ver a base de dados `auth_db` e as cole√ß√µes criadas pelo seed (ex: `users`, `materials`).

---

## 4. Verificar dados pelo terminal (opcional)

1. **Acede ao shell do MongoDB dentro do container:**
   ```sh
   docker exec -it mongo_db mongosh -u app_user -p app_password --authenticationDatabase auth_db
   ```

2. **Comandos √∫teis:**
   ```js
   show dbs
   use auth_db
   show collections
   db.users.find()
   db.materials.find()
   ```

---

## 5. Notas finais

- Se mudares credenciais no `docker-compose.yml`, reinicia sempre os containers.
- O MongoDB s√≥ mostra a base de dados se j√° tiver documentos inseridos.
- Se precisares de limpar tudo, podes apagar o volume Docker:
  ```sh
  docker-compose down -v
  ```

---

D√∫vidas? Pergunta ao Tomas! üòâ